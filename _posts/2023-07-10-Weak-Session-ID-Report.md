# Session ID Vulnerability


## Table of Contents
- [**Outline**](#section-0)
- [**Vulnerability Explanation**](#section-1)
- [ **Proof of Concept**](#section-2)
- [ **Source Code Analysis**](#section-3)
- [**Mitigating Weak Session ID Vulnerability**](#section-4)

## Outline {#section-0}
The goal of this write-up is to understand and predict dvwa's session_id creation process and thereby provide a detailed analysis of the vulnerability, its impact, and recommended mitigation measures.

## Vulnerability Explanation {#section-1}
![](/assets/session/IMAGE.png)   

Session IDs are  used to track and identify user sessions on websites or web applications. They are generated by the server and assigned to users upon login or when a session is initiated

A weak session ID refers to a session identifier that lacks sufficient randomness or unpredictability. This makes it easier for attackers to guess or manipulate session IDs to gain unauthorized access to user accounts or perform session hijacking attack.



## Proof of Concept {#section-2}
The tester first utilzed Burpsuite to intercept the POST request from the `Generate` button. 
Burpsuite is a powerful web application secuirty testing and penetration testing tool. Upon intercepting the request, the tester sent the request to repeater and continously sent the request to see how the session_ id changed.  

![](/assets/session/session1.gif) 

Examining the output, the tester easily predicted that the `session_id` is incremented by one. The tester also utilized Burspsuite's sequencer tool to analyize the randomness and predictability of session tokens.  

    
 As expected, the overall quality of randomness is `extremely poor` with low entropy.


In the second scenario, the tester also intercepted the request to examin the change in `session_id`.  


 The tester noticed that the session_ids are sequentially incremented when the generate button was constantly pressed. However, the tester also realized that the session_id values incremented according to time.  

  ![](/assets/session/sequence21.gif)   

The overall quality of randomness is `extremely poor` with a low entropy as well.

In the last scenario, the tester also intercepted the request to examin the change in `session_id`. Although, at initial glance, the cookie values seem rather random and unpredictable, further analysis reveals that the values are `md5` hashed.

Cracking the hashes, the tester realized that incremental values were hashed with `md5`



## Source Code Analysis {#section-3}
### Security-Low-Level
```php
<?php

$html = "";

if ($_SERVER['REQUEST_METHOD'] == "POST") {
    if (!isset ($_SESSION['last_session_id'])) {
        $_SESSION['last_session_id'] = 0;
    }
    $_SESSION['last_session_id']++;
    $cookie_value = $_SESSION['last_session_id'];
    setcookie("dvwaSession", $cookie_value);
}
?> 

```
In the `Security Low Level Module ` the application exhibits a flaw in its session handling process. When the tester repeadtedly clicked on the `Generate` button, the tester  observed that the server responds with a Set-Cookie command, incrementing the value of the dvwaSession cookie with each request. This behavior allows an attacker to predict future and previous session cookies, enabling them to impersonate legitimate users and gain unauthorized access to sensitive information or perform malicious operations

### Security-Medium-Level
```php
<?php

$html = "";

if ($_SERVER['REQUEST_METHOD'] == "POST") {
    $cookie_value = time();
    setcookie("dvwaSession", $cookie_value);
}
?> 
```
In the `Security Medium Level Module `  the cookie values are set with the time() function. The output format aligns with the UNIX time. Similar to the `Low Level Module` the vulnerability arises from the lack of randomness and predictability in the session cookie values. The time() function generates session IDs based on the current time, which follows a predictable and incremental pattern. Attackers can take advantage of this predictability to guess or calculate the session IDs.


### Security-High-Level
```php
<?php

$html = "";

if ($_SERVER['REQUEST_METHOD'] == "POST") {
    if (!isset ($_SESSION['last_session_id_high'])) {
        $_SESSION['last_session_id_high'] = 0;
    }
    $_SESSION['last_session_id_high']++;
    $cookie_value = md5($_SESSION['last_session_id_high']);
    setcookie("dvwaSession", $cookie_value, time()+3600, "/vulnerabilities/weak_id/", $_SERVER['HTTP_HOST'], false, false);
}

?> 
``` 
In the `Security High Level Module ` the cookie values are created and hashed using `md5`. The session ID is set as the value of the dvwaSession cookie using the `setcookie() function`. The cookie is configured with an expiration time of 1 hour `(time()+3600)`, limited to the `/vulnerabilities/weak_id/` path. Although this enhances  randomess and reduces predictability in session cookie values, the next session_id was predictable as soon as the tester realized it was hashed with `md5`.  `md5` is a relatively weak hashing algorithm by today's standards and was therefore easily crackable.



## Mitigating Weak Session ID Vulnerability {#section-4}  
## Unpredictability
## Insufficient length
## Randomness
## Secure Transmission

### Reference: 
[GrootBoan](https://security.grootboan.com/) , [SECN](https://secnhack.in/take-meterpreter-of-website-using-sqlmap-os-shell/) &
[Portswigger](https://portswigger.net/web-security/sql-injection#how-to-prevent-sql-injection) 